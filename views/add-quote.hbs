<div class="container">
    <div class="page-header">
        <h1>‚ú® Add New Quote</h1>
        <a href="/home" class="btn btn-secondary">‚Üê Back to Quotes</a>
    </div>

    <form action="/add-quote" method="POST" class="quote-form" id="quoteForm">
        <div class="form-group">
            <label for="quoteText">Quote *</label>
            <textarea 
                id="quoteText" 
                name="quoteText" 
                rows="4" 
                required
                placeholder="Enter the funny quote here..."
            ></textarea>
        </div>

        <div class="form-group">
            <label for="personName">Who said it? *</label>
            <select id="personSelect">
                <option value="">-- Select a person --</option>
                {{#each people}}
                    <option value="{{this}}">{{this}}</option>
                {{/each}}
                <option value="__new__">‚ûï Add New Person</option>
            </select>
            
            <input 
                type="text" 
                id="newPersonInput"
                placeholder="Enter new person's name"
                style="display: none; margin-top: 0.75rem;"
            >
            
            <input type="hidden" name="personName" id="personNameHidden" required>
        </div>

        <div class="form-group">
            <label for="location">Where did this happen?</label>
            <input 
                type="text" 
                id="location" 
                name="location"
                placeholder="Location (optional)"
            >
        </div>

        <div class="form-group">
            <label for="date">Date</label>
            <input 
                type="date" 
                id="date" 
                name="date"
            >
        </div>

        <button type="submit" class="btn btn-primary btn-large">üíæ Save Quote</button>
    </form>
</div>

<script>
    const personSelect = document.getElementById('personSelect');
    const newPersonInput = document.getElementById('newPersonInput');
    const personNameHidden = document.getElementById('personNameHidden');
    const form = document.getElementById('quoteForm');
    
    // Update hidden field when dropdown changes
    personSelect.addEventListener('change', function() {
        if (this.value === '__new__') {
            // Show new person input
            personSelect.style.display = 'none';
            newPersonInput.style.display = 'block';
            newPersonInput.required = true;
            personNameHidden.value = '';
            newPersonInput.focus();
        } else {
            // Use selected person
            personNameHidden.value = this.value;
        }
    });
    
    // Update hidden field when typing new person name
    newPersonInput.addEventListener('input', function() {
        personNameHidden.value = this.value;
    });
    
    // Allow going back to dropdown if input is cleared
    newPersonInput.addEventListener('blur', function() {
        if (!this.value.trim()) {
            personSelect.style.display = 'block';
            newPersonInput.style.display = 'none';
            newPersonInput.required = false;
            personSelect.value = '';
            personNameHidden.value = '';
        }
    });
</script>